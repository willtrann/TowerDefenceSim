<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>App.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">scaffold</a> &gt; <a href="index.source.html" class="el_package">WizardTD</a> &gt; <span class="el_source">App.java</span></div><h1>App.java</h1><pre class="source lang-java linenums">package WizardTD;

import processing.core.PApplet;
import processing.core.PImage;
import processing.data.JSONArray;
import processing.data.JSONObject;
import processing.event.MouseEvent;

import java.awt.Graphics2D;
import java.awt.geom.AffineTransform;
import java.awt.image.BufferedImage;

import java.io.*;
import java.util.*;

/**
 * The type App.
 */
public class App extends PApplet {

    /**
     * The constant CELLSIZE.
     */
    public static final int CELLSIZE = 32;
    /**
     * The constant SIDEBAR.
     */
    public static final int SIDEBAR = 120;
    /**
     * The constant TOPBAR.
     */
    public static final int TOPBAR = 40;
    /**
     * The constant BOARD_WIDTH.
     */
    public static final int BOARD_WIDTH = 20;

    /**
     * The constant WIDTH.
     */
<span class="fc" id="L41">    public static int WIDTH = CELLSIZE*BOARD_WIDTH+SIDEBAR;</span>
    /**
     * The constant HEIGHT.
     */
<span class="fc" id="L45">    public static int HEIGHT = BOARD_WIDTH*CELLSIZE+TOPBAR;</span>

    /**
     * The constant FPS.
     */
    public static final int FPS = 60;

    /**
     * The Shrub img.
     */
    PImage shrub_img, /**
     * The Path 1 img.
     */
    path1_img, /**
     * The Path 2 img.
     */
    path2_img, /**
     * The Path 3 img.
     */
    path3_img, /**
     * The Path 0 img.
     */
    path0_img, /**
     * The Wizardhouse img.
     */
    wizardhouse_img, /**
     * The Grass img.
     */
    grass_img;

    /**
     * The Config path.
     */
    public String configPath;

    /**
     * The Waves.
     */
    public List&lt;Wave&gt; waves;
    /**
     * The Multiplier.
     */
<span class="fc" id="L87">    public double multiplier = 1.0;</span>
    /**
     * The Wave timer.
     */
<span class="fc" id="L91">    public double waveTimer = 0;</span>
    /**
     * The Current wave index.
     */
<span class="fc" id="L95">    public int currentWaveIndex = 0;</span>
    /**
     * The First run.
     */
<span class="fc" id="L99">    public boolean firstRun = true;</span>
    /**
     * The Active monsters.
     */
<span class="fc" id="L103">    public List&lt;Monster&gt; activeMonsters = new ArrayList&lt;&gt;();</span>
    /**
     * The Active towers.
     */
<span class="fc" id="L107">    public List&lt;Tower&gt; activeTowers = new ArrayList&lt;&gt;();</span>
    /**
     * The Active fireballs.
     */
<span class="fc" id="L111">    public List&lt;Fireball&gt; activeFireballs = new ArrayList&lt;&gt;();</span>
    /**
     * The Normal tower images.
     */
<span class="fc" id="L115">    public List&lt;PImage&gt; normalTowerImages = new ArrayList&lt;&gt;();</span>
    /**
     * The Slow tower images.
     */
<span class="fc" id="L119">    public List&lt;PImage&gt; slowTowerImages = new ArrayList&lt;&gt;();</span>

    /**
     * The Entrances.
     */
    public List&lt;Coordinate&gt; entrances;
    /**
     * The Fireball image.
     */
    public PImage fireballImage, /**
     * The Slowball image.
     */
    slowballImage;
    /**
     * The Grid boolean.
     */
<span class="fc" id="L135">    public boolean[][] gridBoolean = new boolean[20][20];</span>

    /**
     * The Game mana.
     */
    public Mana gameMana;
    /**
     * The Upgrade on spot.
     */
<span class="fc" id="L144">    public List&lt;String&gt; upgradeOnSpot = new ArrayList&lt;&gt;();</span>

    /**
     * The Icons.
     */
<span class="fc" id="L149">    public String[] icons = {&quot;FF&quot;, &quot;P&quot;, &quot;T&quot;, &quot;S&quot;,&quot;U1&quot;, &quot;U2&quot;, &quot;U3&quot;, &quot;M&quot;};</span>
    /**
     * The Icons labels.
     */
<span class="fc" id="L153">    public String[] icons_labels = {&quot;x2 speed&quot;, &quot;PAUSE&quot;, &quot;Build Tower&quot;, &quot;Build Slow Tower&quot;,&quot;Upgrade Range&quot;, &quot;Upgrade Speed&quot;, &quot;Upgrade Damage&quot;, &quot;Mana pool cost:&quot;};</span>

    /**
     * The Custom frame count.
     */
<span class="fc" id="L158">    public int customFrameCount = 0;</span>
    /**
     * The Config.
     */
    public JSONObject config;
    /**
     * The Selected tower.
     */
    public Tower selectedTower;
    /**
     * The Icon selected.
     */
<span class="fc" id="L170">    public List&lt;String&gt; iconSelected = new ArrayList&lt;&gt;();</span>
    /**
     * The Last wave.
     */
    public boolean lastWave;
    /**
     * The Last wave spawned.
     */
    public boolean lastWaveSpawned;


    /**
     * The enum Game phase.
     */
<span class="fc" id="L184">    enum GamePhase{</span>
        /**
         * Normal game phase.
         */
<span class="fc" id="L188">        Normal,</span>
        /**
         * Double speed game phase.
         */
<span class="fc" id="L192">        DoubleSpeed,</span>
        /**
         * Paused game phase.
         */
<span class="fc" id="L196">        Paused,</span>
        /**
         * Lose game phase.
         */
<span class="fc" id="L200">        Lose,</span>
        /**
         * Win game phase.
         */
<span class="fc" id="L204">        Win;</span>

    }

    /**
     * The enum Tower operation.
     */
<span class="fc" id="L211">    enum TowerOperation{</span>
        /**
         * Normal tower operation.
         */
<span class="fc" id="L215">        Normal,</span>
        /**
         * Tower placing tower operation.
         */
<span class="fc" id="L219">        TowerPlacing,</span>
        /**
         * Slow tower placing tower operation.
         */
<span class="fc" id="L223">        SlowTowerPlacing,</span>
        /**
         * Tower selected tower operation.
         */
<span class="fc" id="L227">        TowerSelected,</span>
        /**
         * Tower dual operation tower operation.
         */
<span class="fc" id="L231">        TowerDualOperation;</span>
    }

    /**
     * The Game phase.
     */
<span class="fc" id="L237">    public GamePhase gamePhase = GamePhase.Normal;</span>
    /**
     * The Tower operation.
     */
<span class="fc" id="L241">    public TowerOperation towerOperation = TowerOperation.Normal;</span>

    /**
     * The Normal tower cost.
     */
    int normal_tower_cost;
    /**
     * The Tower cost combination.
     */
<span class="fc" id="L250">    int tower_cost_combination = 0;</span>
    /**
     * The Normal tower range.
     */
    int normal_tower_range;
    /**
     * The Normal firing speed.
     */
    double normal_firing_speed;
    /**
     * The Normal tower damage.
     */
    int normal_tower_damage;

    /**
     * The Slowtower cost.
     */
    int slowtower_cost;
    /**
     * The Slowtower range.
     */
    int slowtower_range;
    /**
     * The Slowtower firing speed.
     */
    double slowtower_firing_speed;
    /**
     * The Slowtower damage.
     */
    int slowtower_damage;
    /**
     * The Slowtower slow.
     */
    double slowtower_slow;

    /**
     * Load json json object.
     *
     * @param path the path
     * @return the json object
     */
    public JSONObject loadJSON(String path) {
<span class="fc" id="L292">        String[] lines = loadStrings(path);</span>
<span class="fc" id="L293">        String jsonString = join(lines, &quot;&quot;); // get all the json objects from json path</span>
<span class="fc" id="L294">        return  JSONObject.parse(jsonString);</span>
    }

    /**
     * Get path p image.
     *
     * @param main_line  the main line
     * @param map_points the map points
     * @param i          the
     * @param j          the j
     * @param path0_img  the path 0 img
     * @param path1_img  the path 1 img
     * @param path2_img  the path 2 img
     * @param path3_img  the path 3 img
     * @return the p image
     */
    public PImage getPath(String main_line, ArrayList&lt;String&gt; map_points, int i, int j, PImage path0_img, PImage path1_img, PImage path2_img,PImage path3_img){
        int leftPoint, rightPoint, upPoint, downPoint;
        char leftElem, rightElem, upElem, downElem;
<span class="fc" id="L313">        leftPoint = j - 1;</span>
<span class="fc" id="L314">        rightPoint = j + 1;</span>
<span class="fc" id="L315">        upPoint = i - 1;</span>
<span class="fc" id="L316">        downPoint = i + 1;//points adjacent to point</span>

<span class="fc" id="L318">        int max_vert = map_points.size();</span>
<span class="fc" id="L319">        int max_hori = main_line.length();</span>


<span class="pc bpc" id="L322" title="1 of 4 branches missed.">        if (0 &lt;= leftPoint &amp;&amp; leftPoint &lt; max_hori) {</span>
<span class="fc" id="L323">            leftElem = main_line.charAt(leftPoint); // if left point not empty</span>
        }
        else{
<span class="fc" id="L326">            leftElem = ' ';</span>
        }
<span class="pc bpc" id="L328" title="2 of 4 branches missed.">        if (0 &lt;= rightPoint &amp;&amp; rightPoint &lt; max_hori) {</span>
<span class="fc" id="L329">            rightElem = main_line.charAt(rightPoint); // if right point not empty</span>
        }
        else{
<span class="nc" id="L332">            rightElem = ' ';</span>
        }
<span class="pc bpc" id="L334" title="1 of 4 branches missed.">        if (0 &lt;= upPoint &amp;&amp; upPoint &lt; max_vert) {</span>
<span class="fc" id="L335">            upElem = map_points.get(upPoint).charAt(j); // if up point not empty</span>
        }
        else{
<span class="fc" id="L338">            upElem = ' ';</span>
        }

<span class="pc bpc" id="L341" title="2 of 4 branches missed.">        if (0 &lt;= downPoint &amp;&amp; downPoint &lt; max_vert) {</span>
<span class="fc" id="L342">            downElem = map_points.get(downPoint).charAt(j); // if down point not empty</span>
        }
        else{
<span class="nc" id="L345">            downElem = ' ';</span>
        }

<span class="fc bfc" id="L348" title="All 2 branches covered.">        boolean leftCon = leftElem == 'X'; // if theres an X adjacent to point</span>
<span class="fc bfc" id="L349" title="All 2 branches covered.">        boolean rightCon = rightElem == 'X';</span>
<span class="fc bfc" id="L350" title="All 2 branches covered.">        boolean upCon = upElem == 'X';</span>
<span class="fc bfc" id="L351" title="All 2 branches covered.">        boolean downCon = downElem == 'X';</span>


        // returns an image based on boolean connections and rotates if necessary to fulfill joining

<span class="pc bpc" id="L356" title="1 of 8 branches missed.">        if(leftCon &amp;&amp; rightCon &amp;&amp; !upCon &amp;&amp; !downCon){</span>
<span class="fc" id="L357">            return path0_img;</span>
        }
<span class="pc bpc" id="L359" title="1 of 8 branches missed.">        else if(!leftCon &amp;&amp; !rightCon &amp;&amp; (upCon || downCon)) {</span>
<span class="fc" id="L360">            return rotateImageByDegrees(path0_img, 90);</span>
        }
<span class="pc bpc" id="L362" title="1 of 8 branches missed.">        else if(leftCon &amp;&amp; !rightCon &amp;&amp; !upCon &amp;&amp; downCon) {</span>
<span class="fc" id="L363">            return path1_img;</span>
        }
<span class="pc bpc" id="L365" title="1 of 8 branches missed.">        else if(leftCon &amp;&amp; !rightCon &amp;&amp; upCon &amp;&amp; !downCon) {</span>
<span class="fc" id="L366">            return rotateImageByDegrees(path1_img,90);</span>
        }
<span class="pc bpc" id="L368" title="4 of 8 branches missed.">        else if(!leftCon &amp;&amp; rightCon &amp;&amp; upCon &amp;&amp; !downCon) {</span>
<span class="nc" id="L369">            return rotateImageByDegrees(path1_img, 180);</span>
        }
<span class="pc bpc" id="L371" title="2 of 8 branches missed.">        else if(!leftCon &amp;&amp; rightCon &amp;&amp; !upCon &amp;&amp; downCon) {</span>
<span class="fc" id="L372">            return rotateImageByDegrees(path1_img, -90);</span>
        }
<span class="pc bpc" id="L374" title="3 of 8 branches missed.">        else if(leftCon &amp;&amp; rightCon &amp;&amp; !upCon &amp;&amp; downCon) {</span>
<span class="nc" id="L375">            return path2_img;</span>
        }
<span class="pc bpc" id="L377" title="1 of 8 branches missed.">        else if(leftCon &amp;&amp; rightCon &amp;&amp; upCon &amp;&amp; !downCon) {</span>
<span class="fc" id="L378">            return rotateImageByDegrees(path2_img, 180);</span>
        }
<span class="pc bpc" id="L380" title="2 of 8 branches missed.">        else if(leftCon &amp;&amp; !rightCon &amp;&amp; upCon &amp;&amp; downCon) {</span>
<span class="fc" id="L381">            return rotateImageByDegrees(path2_img,90);</span>
        }
<span class="pc bpc" id="L383" title="4 of 8 branches missed.">        else if(!leftCon &amp;&amp; rightCon &amp;&amp; upCon &amp;&amp; downCon) {</span>
<span class="nc" id="L384">            return rotateImageByDegrees(path2_img, 90);</span>
        }
<span class="pc bpc" id="L386" title="3 of 8 branches missed.">        else if(leftCon &amp;&amp; rightCon &amp;&amp; upCon &amp;&amp; downCon) {</span>
<span class="fc" id="L387">            return path3_img;</span>
        }
        else{
<span class="fc" id="L390">            return path0_img;</span>
        }
    }

    /**
     * Wizard house.
     */
    public void WizardHouse(){
<span class="fc" id="L398">        wizardhouse_img = loadImage(&quot;src/main/resources/WizardTD/wizard_house.png&quot;);</span>
<span class="fc" id="L399">        File f = new File(config.getString(&quot;layout&quot;));</span>

        try {
<span class="fc" id="L402">            Scanner scan = new Scanner(f);</span>
<span class="fc" id="L403">            ArrayList&lt;String&gt; map_points = new ArrayList&lt;&gt;(); // get map</span>
<span class="fc bfc" id="L404" title="All 2 branches covered.">            while (scan.hasNextLine()) {</span>
<span class="fc" id="L405">                map_points.add(scan.nextLine());</span>
            }

<span class="fc" id="L408">            int height = map_points.size();</span>

<span class="fc" id="L410">            int maxWidth = 0;</span>
<span class="fc bfc" id="L411" title="All 2 branches covered.">            for (String line : map_points) {</span>
<span class="fc bfc" id="L412" title="All 2 branches covered.">                if (line.length() &gt; maxWidth) {</span>
<span class="fc" id="L413">                    maxWidth = line.length();</span>
                }
<span class="fc" id="L415">            }</span>
<span class="fc" id="L416">            int y = 0; // vert</span>
<span class="fc bfc" id="L417" title="All 2 branches covered.">            while (y &lt; height) {</span>
<span class="fc" id="L418">                String temp_line = map_points.get(y);</span>
<span class="fc" id="L419">                int x = 0; // horiz</span>
<span class="fc bfc" id="L420" title="All 2 branches covered.">                while (x &lt; maxWidth) {</span>

                    char temp;
<span class="fc bfc" id="L423" title="All 2 branches covered.">                    if (x &lt; temp_line.length()) {</span>
<span class="fc" id="L424">                        temp = temp_line.charAt(x); // loop through map until find Wizard house W</span>
                    } else {
<span class="fc" id="L426">                        temp = ' ';</span>
                    }

<span class="fc bfc" id="L429" title="All 2 branches covered.">                    if (temp == 'W') {</span>
                        char leftElem, rightElem, upElem, downElem;

<span class="fc" id="L432">                        int leftPoint = x - 1; // gets adjacent points to wizard house</span>
<span class="fc" id="L433">                        int rightPoint = x + 1;</span>
<span class="fc" id="L434">                        int upPoint = y - 1;</span>
<span class="fc" id="L435">                        int downPoint = y + 1;</span>

<span class="fc" id="L437">                        int max_vert = map_points.size();</span>
<span class="fc" id="L438">                        int max_hori = temp_line.length();</span>

                        // gets element at adjacent points

<span class="pc bpc" id="L442" title="2 of 4 branches missed.">                        if (0 &lt;= leftPoint &amp;&amp; leftPoint &lt; max_hori) {</span>
<span class="fc" id="L443">                            leftElem = temp_line.charAt(leftPoint);</span>
                        } else {
<span class="nc" id="L445">                            leftElem = ' ';</span>
                        }
<span class="pc bpc" id="L447" title="2 of 4 branches missed.">                        if (0 &lt;= rightPoint &amp;&amp; rightPoint &lt; max_hori) {</span>
<span class="fc" id="L448">                            rightElem = temp_line.charAt(rightPoint);</span>
                        } else {
<span class="nc" id="L450">                            rightElem = ' ';</span>
                        }
<span class="pc bpc" id="L452" title="2 of 4 branches missed.">                        if (0 &lt;= upPoint &amp;&amp; upPoint &lt; max_vert) {</span>
<span class="fc" id="L453">                            upElem = map_points.get(upPoint).charAt(x);</span>
                        } else {
<span class="nc" id="L455">                            upElem = ' ';</span>
                        }

<span class="pc bpc" id="L458" title="2 of 4 branches missed.">                        if (0 &lt;= downPoint &amp;&amp; downPoint &lt; max_vert) {</span>
<span class="fc" id="L459">                            downElem = map_points.get(downPoint).charAt(x);</span>
                        } else {
<span class="nc" id="L461">                            downElem = ' ';</span>
                        }

<span class="pc bpc" id="L464" title="1 of 2 branches missed.">                        boolean leftCon = leftElem == 'X'; // see what X is adjacent to wizard house</span>
<span class="pc bpc" id="L465" title="1 of 2 branches missed.">                        boolean rightCon = rightElem == 'X';</span>
<span class="pc bpc" id="L466" title="1 of 2 branches missed.">                        boolean upCon = upElem == 'X';</span>
<span class="pc bpc" id="L467" title="1 of 2 branches missed.">                        boolean downCon = downElem == 'X';</span>

                        // draws image of wizard house at point and rotates if required

<span class="pc bpc" id="L471" title="1 of 2 branches missed.">                        if (rightCon) {</span>
<span class="fc" id="L472">                            image(wizardhouse_img, x * CELLSIZE - 8, y * CELLSIZE + CELLSIZE);</span>
<span class="nc bnc" id="L473" title="All 2 branches missed.">                        } else if (leftCon) {</span>
<span class="nc" id="L474">                            image(rotateImageByDegrees(wizardhouse_img, 180), x * CELLSIZE - 8, y * CELLSIZE + CELLSIZE);</span>
<span class="nc bnc" id="L475" title="All 2 branches missed.">                        } else if (upCon) {</span>
<span class="nc" id="L476">                            image(rotateImageByDegrees(wizardhouse_img, -90), x * CELLSIZE - 8, y * CELLSIZE + CELLSIZE);</span>
<span class="nc bnc" id="L477" title="All 2 branches missed.">                        } else if (downCon) {</span>
<span class="nc" id="L478">                            image(rotateImageByDegrees(wizardhouse_img, 90), x * CELLSIZE - 8, y * CELLSIZE + CELLSIZE);</span>
                        }
                    }
<span class="fc" id="L481">                    x++;</span>
<span class="fc" id="L482">                }</span>
<span class="fc" id="L483">                y++;</span>
<span class="fc" id="L484">            }</span>
<span class="nc" id="L485">        }catch(FileNotFoundException e){</span>
<span class="nc" id="L486">            System.out.println(&quot;Invalid file!&quot;);</span>
<span class="fc" id="L487">        }</span>
<span class="fc" id="L488">    }</span>

    /**
     * Setup grid.
     */
    public void setupGrid(){

<span class="fc" id="L495">        File f = new File(config.getString(&quot;layout&quot;)); // get map</span>


        try{
<span class="fc" id="L499">            Scanner scan = new Scanner(f);</span>
<span class="fc" id="L500">            ArrayList&lt;String&gt; map_points= new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L501" title="All 2 branches covered.">            while(scan.hasNextLine()){</span>
<span class="fc" id="L502">                map_points.add(scan.nextLine());</span>
            }

<span class="fc" id="L505">            int height = map_points.size();</span>

<span class="fc" id="L507">            int maxWidth = 0;</span>
<span class="fc bfc" id="L508" title="All 2 branches covered.">            for (String line : map_points) {</span>
<span class="fc bfc" id="L509" title="All 2 branches covered.">                if (line.length() &gt; maxWidth) {</span>
<span class="fc" id="L510">                    maxWidth = line.length();</span>
                }
<span class="fc" id="L512">            }</span>

<span class="fc" id="L514">            int i = 0; // vert</span>
<span class="fc bfc" id="L515" title="All 2 branches covered.">            while(i &lt; height) {</span>
<span class="fc" id="L516">                String temp_line = map_points.get(i);</span>
<span class="fc" id="L517">                int j = 0; // horiz</span>
<span class="fc bfc" id="L518" title="All 2 branches covered.">                while (j &lt; maxWidth) {</span>

                    char temp;
<span class="fc bfc" id="L521" title="All 2 branches covered.">                    if (j &lt; temp_line.length()) {</span>
<span class="fc" id="L522">                        temp = temp_line.charAt(j);</span>
                    } else {
<span class="fc" id="L524">                        temp = ' ';</span>
                    }

<span class="fc bfc" id="L527" title="All 6 branches covered.">                    if (temp == 'S' || temp == 'X' || temp == 'W') { // fills boolean grid depending if space is occupied or not</span>
<span class="fc" id="L528">                        gridBoolean[i][j] = false;</span>
                    }
                    else{
<span class="fc" id="L531">                        gridBoolean[i][j] = true;</span>
                    }
<span class="fc" id="L533">                    j++;</span>
<span class="fc" id="L534">                }</span>
<span class="fc" id="L535">                i++;</span>
<span class="fc" id="L536">            }</span>
<span class="nc" id="L537">        } catch(FileNotFoundException e){</span>
<span class="nc" id="L538">            System.err.println(&quot;File not found!&quot;);</span>
<span class="fc" id="L539">        }</span>
<span class="fc" id="L540">    }</span>

    /**
     * Map.
     */
    public void Map(){

<span class="fc" id="L547">        File f = new File(config.getString(&quot;layout&quot;));</span>

        try{
<span class="fc" id="L550">            Scanner scan = new Scanner(f);</span>
<span class="fc" id="L551">            ArrayList&lt;String&gt; map_points= new ArrayList&lt;&gt;(); // load map</span>
<span class="fc bfc" id="L552" title="All 2 branches covered.">            while(scan.hasNextLine()){</span>
<span class="fc" id="L553">                map_points.add(scan.nextLine());</span>
            }

<span class="fc" id="L556">            int height = map_points.size();</span>

<span class="fc" id="L558">            int maxWidth = 0;</span>
<span class="fc bfc" id="L559" title="All 2 branches covered.">            for (String line : map_points) {</span>
<span class="fc bfc" id="L560" title="All 2 branches covered.">                if (line.length() &gt; maxWidth) {</span>
<span class="fc" id="L561">                    maxWidth = line.length();</span>
                }
<span class="fc" id="L563">            }</span>

<span class="fc" id="L565">            int i = 0; // vert</span>
<span class="fc bfc" id="L566" title="All 2 branches covered.">            while(i &lt; height) {</span>
<span class="fc" id="L567">                String temp_line = map_points.get(i);</span>
<span class="fc" id="L568">                int j = 0; // horiz</span>
<span class="fc bfc" id="L569" title="All 2 branches covered.">                while (j &lt; maxWidth) {</span>

                    char temp;
<span class="fc bfc" id="L572" title="All 2 branches covered.">                    if (j &lt; temp_line.length()) {</span>
<span class="fc" id="L573">                        temp = temp_line.charAt(j);</span>
                    } else {
<span class="fc" id="L575">                        temp = ' ';</span>
                    }

<span class="fc bfc" id="L578" title="All 2 branches covered.">                    if (temp == 'S') {</span>
<span class="fc" id="L579">                        image(shrub_img, j * CELLSIZE, i * CELLSIZE + TOPBAR); // image(img, horiz, vert)</span>
<span class="fc bfc" id="L580" title="All 2 branches covered.">                    } else if (temp == 'X') {</span>
<span class="fc" id="L581">                        PImage path_img = getPath(temp_line, map_points, i, j, path0_img, path1_img, path2_img, path3_img);</span>
<span class="fc" id="L582">                        image(path_img, j * CELLSIZE, i * CELLSIZE + TOPBAR); // draw map element based on map file</span>
<span class="fc" id="L583">                    }</span>
                    else{
<span class="fc" id="L585">                        image(grass_img, j * CELLSIZE, i * CELLSIZE + TOPBAR);</span>
                    }
<span class="fc" id="L587">                    j++;</span>
<span class="fc" id="L588">                }</span>
<span class="fc" id="L589">                i++;</span>
<span class="fc" id="L590">            }</span>
<span class="nc" id="L591">        } catch(FileNotFoundException e){</span>
<span class="nc" id="L592">            System.err.println(&quot;File not found!&quot;);</span>
<span class="fc" id="L593">        }</span>
<span class="fc" id="L594">    }</span>

    /**
     * Monster array list list.
     *
     * @param list the list
     * @return the list
     */
    public List&lt;Monster&gt; monsterArrayList(JSONArray list){
<span class="fc" id="L603">        List&lt;Monster&gt; monsters = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L604">        int i = 0;</span>

<span class="fc bfc" id="L606" title="All 2 branches covered.">        while(i &lt; list.size()){</span>
<span class="fc" id="L607">            JSONObject monsterObject = list.getJSONObject(i);</span>
<span class="fc" id="L608">            String sType = monsterObject.getString(&quot;type&quot;); // get monster attributes from json object</span>
<span class="fc" id="L609">            int hp = monsterObject.getInt(&quot;hp&quot;);</span>
<span class="fc" id="L610">            float speed = monsterObject.getFloat(&quot;speed&quot;);</span>
<span class="fc" id="L611">            double armour = monsterObject.getDouble(&quot;armour&quot;);</span>
<span class="fc" id="L612">            int manaGainedOnKill = monsterObject.getInt(&quot;mana_gained_on_kill&quot;);</span>
<span class="fc" id="L613">            int quantity = monsterObject.getInt(&quot;quantity&quot;);</span>

<span class="fc" id="L615">            int j = 0;</span>
<span class="fc bfc" id="L616" title="All 2 branches covered.">            while(j &lt; quantity){</span>
<span class="pc bpc" id="L617" title="1 of 2 branches missed.">                if(sType != null){ // appends monster to arraylist for wave if it isnt null</span>
<span class="fc" id="L618">                    monsters.add(new Monster(loadMonsterImages(sType), hp, speed, armour, manaGainedOnKill));</span>
                }
                else{
<span class="nc" id="L621">                    return null;</span>
                }
<span class="fc" id="L623">                j ++;</span>
            }

<span class="fc" id="L626">            i ++;</span>
<span class="fc" id="L627">        }</span>

<span class="fc" id="L629">        return monsters;</span>
    }

    /**
     * Get entrances list.
     *
     * @return the list
     */
    public List&lt;Coordinate&gt; getEntrances(){
<span class="fc" id="L638">        List&lt;Coordinate&gt; entranceCoordinates = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L639">        File f = new File(config.getString(&quot;layout&quot;)); // get map</span>

        try {
<span class="fc" id="L642">            Scanner scan = new Scanner(f);</span>
<span class="fc" id="L643">            ArrayList&lt;String&gt; map_points = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L644" title="All 2 branches covered.">            while (scan.hasNextLine()) {</span>
<span class="fc" id="L645">                map_points.add(scan.nextLine());</span>
            }

<span class="fc" id="L648">            int maxWidth = 0;</span>
<span class="fc bfc" id="L649" title="All 2 branches covered.">            for (String line : map_points) {</span>
<span class="fc bfc" id="L650" title="All 2 branches covered.">                if (line.length() &gt; maxWidth) {</span>
<span class="fc" id="L651">                    maxWidth = line.length();</span>
                }
<span class="fc" id="L653">            }</span>

            //checks all boundaries of the map (i.e edges of the map) and see's if any X's are there. if so add to list of entrances

<span class="fc" id="L657">            int i = 0;</span>
<span class="fc bfc" id="L658" title="All 2 branches covered.">            while(i &lt; map_points.size()){</span>
<span class="fc" id="L659">                String line = map_points.get(i);</span>
<span class="fc bfc" id="L660" title="All 2 branches covered.">                if (line.charAt(0) == 'X'){</span>
<span class="fc" id="L661">                    entranceCoordinates.add(new Coordinate(0, i));</span>
                }
                // Check the right side of the line only if the line is as long as maxWidth
<span class="pc bpc" id="L664" title="1 of 4 branches missed.">                if (line.length() == maxWidth &amp;&amp; line.charAt(line.length() - 1) == 'X'){</span>
<span class="nc" id="L665">                    entranceCoordinates.add(new Coordinate(maxWidth - 1, i));</span>
                }
<span class="fc" id="L667">                i++;</span>
<span class="fc" id="L668">            }</span>

<span class="fc" id="L670">            int j = 0;</span>
<span class="fc" id="L671">            String topScreenElems = map_points.get(0);</span>
<span class="fc bfc" id="L672" title="All 2 branches covered.">            while(j &lt; topScreenElems.length()){</span>
<span class="fc bfc" id="L673" title="All 2 branches covered.">                if(topScreenElems.charAt(j) == 'X'){</span>
<span class="fc" id="L674">                    entranceCoordinates.add(new Coordinate(j, 0));</span>
                }
<span class="fc" id="L676">                j ++;</span>
            }

<span class="fc" id="L679">            String bottomScreenElems = map_points.get(map_points.size() - 1);</span>
<span class="fc" id="L680">            int k = 0;</span>
<span class="fc bfc" id="L681" title="All 2 branches covered.">            while(k &lt; bottomScreenElems.length()){</span>
<span class="pc bpc" id="L682" title="1 of 2 branches missed.">                if(bottomScreenElems.charAt(k) == 'X'){</span>
<span class="nc" id="L683">                    entranceCoordinates.add(new Coordinate(k, map_points.size() - 1));</span>
                }
<span class="fc" id="L685">                k ++;</span>
            }

<span class="fc" id="L688">            return entranceCoordinates;</span>
<span class="nc" id="L689">        } catch(FileNotFoundException e){</span>
<span class="nc" id="L690">            System.err.println(&quot;File not found!&quot;);</span>
<span class="nc" id="L691">            return entranceCoordinates; // return empty list if file is not found</span>
        }

    }

    /**
     * Load tower image.
     */
    public void loadTowerImage(){
<span class="fc" id="L700">        PImage tower0 = loadImage(&quot;src/main/resources/WizardTD/tower0.png&quot;);</span>
<span class="fc" id="L701">        PImage tower1 = loadImage(&quot;src/main/resources/WizardTD/tower1.png&quot;);</span>
<span class="fc" id="L702">        PImage tower2 = loadImage(&quot;src/main/resources/WizardTD/tower2.png&quot;); // loading PImage normal tower</span>
<span class="fc" id="L703">        normalTowerImages.add(tower0);</span>
<span class="fc" id="L704">        normalTowerImages.add(tower1);</span>
<span class="fc" id="L705">        normalTowerImages.add(tower2);</span>
<span class="fc" id="L706">        PImage slowtower0 = loadImage(&quot;src/main/resources/WizardTD/slowtower0.png&quot;);</span>
<span class="fc" id="L707">        PImage slowtower1 = loadImage(&quot;src/main/resources/WizardTD/slowtower1.png&quot;);</span>
<span class="fc" id="L708">        PImage slowtower2 = loadImage(&quot;src/main/resources/WizardTD/slowtower2.png&quot;);  //loading PImage slow tower</span>
<span class="fc" id="L709">        slowTowerImages.add(slowtower0);</span>
<span class="fc" id="L710">        slowTowerImages.add(slowtower1);</span>
<span class="fc" id="L711">        slowTowerImages.add(slowtower2);</span>
<span class="fc" id="L712">    }</span>

    /**
     * Load map images.
     */
    public void loadMapImages(){
<span class="fc" id="L718">        shrub_img = loadImage(&quot;src/main/resources/WizardTD/shrub.png&quot;);</span>
<span class="fc" id="L719">        path0_img = loadImage(&quot;src/main/resources/WizardTD/path0.png&quot;); // loading map element images</span>
<span class="fc" id="L720">        path1_img = loadImage(&quot;src/main/resources/WizardTD/path1.png&quot;);</span>
<span class="fc" id="L721">        path2_img = loadImage(&quot;src/main/resources/WizardTD/path2.png&quot;);</span>
<span class="fc" id="L722">        path3_img = loadImage(&quot;src/main/resources/WizardTD/path3.png&quot;);</span>
<span class="fc" id="L723">        grass_img = loadImage(&quot;src/main/resources/WizardTD/grass.png&quot;);</span>
<span class="fc" id="L724">    }</span>

    /**
     * Draw buttons.
     */
    public void drawButtons(){
<span class="fc" id="L730">        int x = WIDTH - SIDEBAR + 10; // x point to draw icon</span>
<span class="fc" id="L731">        int y_offset = TOPBAR + 10;</span>

<span class="fc" id="L733">        strokeWeight(3);</span>
<span class="fc" id="L734">        int i = 0;</span>
<span class="fc bfc" id="L735" title="All 2 branches covered.">        while(i &lt; icons.length){</span>
<span class="fc" id="L736">            int y = y_offset + (50) * i; // get y point to draw icon</span>

<span class="fc bfc" id="L738" title="All 2 branches covered.">            if(iconSelected.contains(icons[i])){</span>
<span class="fc" id="L739">                fill(255, 255, 0); // if icon has been clicked coloured yellow</span>
            }
<span class="pc bpc" id="L741" title="7 of 8 branches missed.">            else if (mouseX &gt; x &amp;&amp; mouseX &lt; x + 40 &amp;&amp; mouseY &gt; y &amp;&amp; mouseY &lt; y + 40) {</span>
<span class="nc" id="L742">                fill(206, 206, 205); // if mouse over icon, coloured grey</span>
            } else {
<span class="fc" id="L744">                fill(132, 115, 74); // if not, colour brown</span>
            }

<span class="fc" id="L747">            rect(x, y, 40, 40); // draw rectangle</span>

<span class="fc" id="L749">            fill(0);</span>
<span class="fc" id="L750">            textSize(25);</span>

<span class="fc" id="L752">            textAlign(CENTER, CENTER);</span>
<span class="fc" id="L753">            text(icons[i], x + 20, y + 20); // symbol text in button</span>


<span class="pc bpc" id="L756" title="7 of 14 branches missed.">            if((icons[i].equals(&quot;T&quot;) || icons[i].equals(&quot;M&quot;) || icons[i].equals(&quot;S&quot;)) &amp;&amp; (mouseX &gt; x &amp;&amp; mouseX &lt; x + 40 &amp;&amp; mouseY &gt; y &amp;&amp; mouseY &lt; y + 40)){</span>
<span class="nc" id="L757">                fill(255, 255, 255);</span>
<span class="nc" id="L758">                rect(x - 70, y, 50, 20); // draw rectangle at point to show cost if its T, M or S</span>

<span class="nc" id="L760">                fill(0);</span>
<span class="nc" id="L761">                textSize(10);</span>

<span class="nc" id="L763">                textAlign(LEFT, CENTER);</span>

<span class="nc bnc" id="L765" title="All 2 branches missed.">                if(icons[i].equals(&quot;T&quot;)) {</span>
<span class="nc" id="L766">                    text(&quot;Cost: &quot; + normal_tower_cost, x - 67, y + 10); // show Tower price</span>
                }
<span class="nc bnc" id="L768" title="All 2 branches missed.">                else if(icons[i].equals(&quot;M&quot;)) {</span>
<span class="nc" id="L769">                    text(&quot;Cost: &quot; + gameMana.getCost(), x - 67, y + 10); // show mana upgrade price</span>
                }
<span class="nc bnc" id="L771" title="All 2 branches missed.">                else if(icons[i].equals(&quot;S&quot;)) {</span>
<span class="nc" id="L772">                    text(&quot;Cost: &quot; + slowtower_cost, x - 67, y + 10); // show slow tower price</span>
                }
            }

<span class="fc" id="L776">            textSize(12);</span>
<span class="fc" id="L777">            textAlign(LEFT, CENTER);</span>

            // draws text of label next to each button

<span class="fc bfc" id="L781" title="All 2 branches covered.">            if(icons_labels[i].split(&quot; &quot;).length &gt;= 2){</span>
<span class="fc bfc" id="L782" title="All 2 branches covered.">                if(i == 0){</span>
<span class="fc" id="L783">                    text(icons_labels[i], x + 45, y + 8);</span>
                }
<span class="fc bfc" id="L785" title="All 2 branches covered.">                else if(i == icons_labels.length - 1){</span>
<span class="fc" id="L786">                    String[] label_split = icons_labels[i].split(&quot; &quot;); // splits if too long</span>
<span class="fc" id="L787">                    text(label_split[0] + &quot; &quot; + label_split[1], x + 45, y + 10);</span>
<span class="fc" id="L788">                    text(label_split[2] + &quot; &quot; + gameMana.getCost(), x + 45, y + 27);</span>
<span class="fc" id="L789">                }</span>
                else {
<span class="fc" id="L791">                    String[] label_split = icons_labels[i].split(&quot; &quot;, 2);</span>
<span class="fc" id="L792">                    text(label_split[0], x + 40 + 5, y + 10); // splits if too long</span>
<span class="fc" id="L793">                    text(label_split[1], x + 40 + 5, y + 27);</span>
<span class="fc" id="L794">                }</span>
            }
            else{
<span class="fc" id="L797">                text(icons_labels[i], x + 45, y + 10); // print one line if only one word</span>
            }
<span class="fc" id="L799">            i++;</span>
<span class="fc" id="L800">        }</span>
<span class="fc" id="L801">        stroke(0);</span>
<span class="fc" id="L802">        strokeWeight(1); // reset stroke</span>
<span class="fc" id="L803">    }</span>

    /**
     * Draw mana.
     */
    public void drawMana(){
<span class="fc" id="L809">        float filledWidth = (float) gameMana.getMana() / gameMana.getMana_cap() * 300; // get part of rectangle that has mana relative to bar</span>

<span class="fc" id="L811">        strokeWeight(2);</span>
<span class="fc" id="L812">        stroke(0);</span>

<span class="fc" id="L814">        fill(255, 255, 255);</span>
<span class="fc" id="L815">        rect(400, 10, 300, 20); // draw background of bar</span>

<span class="fc" id="L817">        fill(0, 214, 214);</span>
<span class="fc" id="L818">        rect(400, 10, filledWidth, 20);  // draw mana user has relative to bar</span>

<span class="fc" id="L820">        fill(0);</span>
<span class="fc" id="L821">        textSize(21);</span>
<span class="fc" id="L822">        text(&quot;MANA:&quot;, 320, 19); // text of mana info</span>
<span class="fc" id="L823">        textAlign(CENTER, CENTER);</span>
<span class="fc" id="L824">        fill(0);</span>
<span class="fc" id="L825">        text(gameMana.getMana() + &quot; / &quot; + gameMana.getMana_cap(), 550, 18);</span>

<span class="fc" id="L827">        strokeWeight(1); // reset stroke</span>
<span class="fc" id="L828">    }</span>

    /**
     * Check tower selected.
     *
     * @param x the x
     * @param y the y
     */
    public void checkTowerSelected(int x, int y){
<span class="pc bpc" id="L837" title="1 of 2 branches missed.">        for(Tower tower:activeTowers) { //loop through towers</span>
<span class="pc bpc" id="L838" title="4 of 8 branches missed.">            if (0 &lt; x &amp;&amp; x &lt; WIDTH - SIDEBAR &amp;&amp; TOPBAR &lt; y &amp;&amp; y &lt; HEIGHT) {</span>
<span class="pc bpc" id="L839" title="4 of 8 branches missed.">                if (tower.getCoordinate().x &lt; x &amp;&amp; x &lt; tower.getCoordinate().x + CELLSIZE &amp;&amp; tower.getCoordinate().y &lt; y &amp;&amp; y &lt; tower.getCoordinate().y + CELLSIZE) {</span>
<span class="fc" id="L840">                    towerOperation = TowerOperation.TowerSelected;</span>
<span class="fc" id="L841">                    selectedTower = tower; // if mouse clicked in bounds of tower, change tower operation state and make new selected tower</span>
<span class="fc" id="L842">                    return;</span>
                } else {
<span class="nc" id="L844">                    selectedTower = null; // otherwise, no tower operation</span>
<span class="nc" id="L845">                    towerOperation = TowerOperation.Normal;</span>
                }
            }
<span class="nc" id="L848">        }</span>
<span class="nc" id="L849">    }</span>

    /**
     * Text game end.
     */
    public void textGameEnd(){
<span class="fc" id="L855">        fill(0, 255, 0);</span>
<span class="fc" id="L856">        textSize(32);</span>
<span class="fc" id="L857">        textAlign(CENTER, CENTER); // green text of you lost</span>
<span class="fc" id="L858">        text(&quot;YOU LOST&quot;, (width / 2) - 40, (height / 2)-130);</span>

<span class="fc" id="L860">        fill(0, 255, 0);</span>
<span class="fc" id="L861">        textSize(32); // green text r to restart</span>
<span class="fc" id="L862">        textAlign(CENTER, CENTER);</span>
<span class="fc" id="L863">        text(&quot;Press 'r' to restart&quot;, (width / 2) - 40, (height / 2)-40);</span>
<span class="fc" id="L864">    }</span>

    /**
     * Text game win.
     */
    public void textGameWin(){
<span class="nc" id="L870">        fill(255, 0, 255);</span>
<span class="nc" id="L871">        textSize(32); // purple text you win</span>
<span class="nc" id="L872">        textAlign(CENTER, CENTER);</span>
<span class="nc" id="L873">        text(&quot;YOU WIN&quot;, (width / 2) - 40, (height / 2)-130);</span>


<span class="nc" id="L876">    }</span>

    /**
     * Restart game phase.
     */
    public void restartGamePhase(){
<span class="fc" id="L882">        firstRun = true;</span>
<span class="fc" id="L883">        activeMonsters.clear();</span>
<span class="fc" id="L884">        activeTowers.clear();</span>
<span class="fc" id="L885">        activeFireballs.clear();</span>
<span class="fc" id="L886">        currentWaveIndex = 0;</span>
<span class="fc" id="L887">        gameMana.resetMana();</span>
<span class="fc" id="L888">        iconSelected.clear();</span>
<span class="fc" id="L889">        gamePhase = GamePhase.Normal;</span>
<span class="fc" id="L890">        towerOperation = TowerOperation.Normal;</span>
<span class="fc" id="L891">        customFrameCount = 0;</span>
<span class="fc" id="L892">        waveTimer =  waves.get(currentWaveIndex).getPre_wave_pause();</span>
<span class="fc" id="L893">        selectedTower = null;</span>
<span class="fc" id="L894">        lastWave =  false;</span>
<span class="fc" id="L895">        lastWaveSpawned = false;</span>
<span class="fc" id="L896">        loadWaves();</span>

        // restart all variables to initial variables
        // clears arraylists
        // reloads waves

<span class="fc" id="L902">    }</span>

    /**
     * Load waves.
     */
    public void loadWaves(){
<span class="fc" id="L908">        JSONArray waveConfigs = config.getJSONArray(&quot;waves&quot;);</span>
<span class="fc" id="L909">        waves = new ArrayList&lt;&gt;(); // all waves for game session</span>

<span class="fc" id="L911">        int i = 0;</span>
<span class="fc bfc" id="L912" title="All 2 branches covered.">        while(i &lt; waveConfigs.size()){</span>
<span class="fc" id="L913">            JSONObject waveInfo = waveConfigs.getJSONObject(i); // get info and attributes of all waves</span>
<span class="fc" id="L914">            int preWavePause = waveInfo.getInt(&quot;pre_wave_pause&quot;);</span>
<span class="fc" id="L915">            int duration = waveInfo.getInt(&quot;duration&quot;);</span>
<span class="fc" id="L916">            JSONArray monstersJSON = waveInfo.getJSONArray(&quot;monsters&quot;);</span>
<span class="fc" id="L917">            List&lt;Monster&gt; monsters = monsterArrayList(monstersJSON); //get arraylist of all monsters in wave</span>
<span class="fc" id="L918">            Wave wave = new Wave(preWavePause, duration, monsters);</span>
<span class="fc" id="L919">            waves.add(wave); // add new wave object into waves arraylist to iterate over</span>
<span class="fc" id="L920">            i ++;</span>
<span class="fc" id="L921">        }</span>
<span class="fc" id="L922">    }</span>

    /**
     * Wave management.
     */
    public void waveManagement(){

<span class="fc bfc" id="L929" title="All 2 branches covered.">        if(firstRun){</span>
<span class="fc" id="L930">            waveTimer = waves.get(currentWaveIndex).getPre_wave_pause(); // get wave timer depending on wave 1 or other wave</span>
<span class="fc" id="L931">            firstRun = false;</span>
        }
        else {
<span class="pc bpc" id="L934" title="1 of 4 branches missed.">            if (waveTimer &lt;= 0 &amp;&amp; currentWaveIndex &lt; (waves.size() - 1)) {</span>
<span class="fc" id="L935">                currentWaveIndex++;</span>
<span class="fc" id="L936">                waveTimer = waves.get(currentWaveIndex).getPre_wave_pause();</span>
            }
        }

<span class="pc bpc" id="L940" title="1 of 2 branches missed.">        if(currentWaveIndex &lt; waves.size()){</span>

<span class="fc" id="L942">            int nextWaveNumber = currentWaveIndex + 1; // while waves are less than the number of waves required</span>
<span class="fc" id="L943">            int secondsUntilNextWave = (int) waveTimer;</span>

<span class="pc bpc" id="L945" title="1 of 4 branches missed.">            if (!(currentWaveIndex == (waves.size() - 1) &amp;&amp; secondsUntilNextWave &lt; 0)) {</span>
<span class="fc" id="L946">                fill(0);</span>
<span class="fc" id="L947">                textSize(25); // draw upcoming wave info</span>
<span class="fc" id="L948">                text(&quot;Wave &quot; + nextWaveNumber + &quot; starts: &quot; + secondsUntilNextWave, 10, 20);</span>
            }
            else{
<span class="nc" id="L951">                lastWave = true;</span>
            }
        }

<span class="pc bpc" id="L955" title="1 of 4 branches missed.">        if(waveTimer &gt;=0 &amp;&amp; currentWaveIndex &gt; 0) {</span>
<span class="fc" id="L956">            Wave currentWave = waves.get(currentWaveIndex - 1); // get current wave</span>
<span class="fc" id="L957">            float framesBetweenSpawns = (float) (60 * currentWave.getDuration()) / currentWave.getSizeMonsters();</span>

<span class="fc bfc" id="L959" title="All 2 branches covered.">            if(customFrameCount % Math.ceil(framesBetweenSpawns) == 0){</span>
<span class="fc" id="L960">                Monster newMonster = currentWave.spawnMonster(); // spawns monster if right duration</span>
<span class="fc bfc" id="L961" title="All 2 branches covered.">                if(newMonster != null) {</span>
<span class="fc" id="L962">                    Random random = new Random();</span>
<span class="fc" id="L963">                    int path_choice = random.nextInt(entrances.size());</span>
<span class="fc" id="L964">                    Coordinate start = entrances.get(path_choice);// get the random entrance of map</span>


<span class="fc" id="L967">                    newMonster.setX_Pos(start.x*CELLSIZE);</span>
<span class="fc" id="L968">                    newMonster.setY_Pos(start.y*CELLSIZE+ TOPBAR); // set monster to start of path</span>

<span class="fc" id="L970">                    File f = new File(config.getString(&quot;layout&quot;));</span>

<span class="fc" id="L972">                    newMonster.setPath(start, f); // get path monster travels under</span>

<span class="fc" id="L974">                    activeMonsters.add(newMonster); // add to all active monsters</span>
                }
            }
<span class="fc" id="L977">        }else{</span>
<span class="fc" id="L978">            Wave currentWave = waves.get(currentWaveIndex); // get current wave</span>
<span class="fc" id="L979">            float framesBetweenSpawns = (float) (60 * currentWave.getDuration()) / currentWave.getSizeMonsters();</span>


<span class="fc bfc" id="L982" title="All 2 branches covered.">            if(customFrameCount % Math.ceil(framesBetweenSpawns) == 0){</span>
<span class="fc" id="L983">                Monster newMonster = currentWave.spawnMonster(); // spawns monster if right duration</span>
<span class="pc bpc" id="L984" title="1 of 2 branches missed.">                if(newMonster != null) {</span>
<span class="fc" id="L985">                    Random random = new Random();</span>
<span class="fc" id="L986">                    int path_choice = random.nextInt(entrances.size());</span>

<span class="fc" id="L988">                    Coordinate start = entrances.get(path_choice);// get the random entrance of map</span>


<span class="fc" id="L991">                    newMonster.setX_Pos(start.x*CELLSIZE);</span>
<span class="fc" id="L992">                    newMonster.setY_Pos(start.y*CELLSIZE+ TOPBAR); // set monster to start of path</span>

<span class="fc" id="L994">                    File f = new File(config.getString(&quot;layout&quot;));</span>

<span class="fc" id="L996">                    newMonster.setPath(start, f); // get path monster travels under</span>

<span class="fc" id="L998">                    activeMonsters.add(newMonster); // add to all active monsters</span>
                }
            }
        }
<span class="fc" id="L1002">    }</span>

    /**
     * Draw details.
     *
     * @param monster the monster
     */
    public void drawDetails(Monster monster){
<span class="fc" id="L1010">        float filledWidth = (float) (monster.getHp() / monster.initial_hp * 40);</span>

<span class="fc" id="L1012">        strokeWeight(0);</span>
<span class="fc" id="L1013">        stroke(0); //draws hp bar</span>

<span class="fc" id="L1015">        fill(255, 0, 0);</span>
<span class="fc" id="L1016">        rect(monster.getX_Pos() - 10, monster.getY_Pos() - 15, 40, 5);</span>

<span class="fc" id="L1018">        fill(0, 255, 0);</span>
<span class="fc" id="L1019">        rect(monster.getX_Pos() - 10, monster.getY_Pos() - 15, filledWidth, 5);</span>

<span class="pc bpc" id="L1021" title="1 of 2 branches missed.">        if(monster.slowed) {</span>
<span class="nc" id="L1022">            fill(255, 255, 0);</span>
<span class="nc" id="L1023">            textSize(12); // if slowed, show text over monster that shows slowed</span>
<span class="nc" id="L1024">            text(&quot;SLOWED&quot;, monster.getX_Pos() - 10, monster.getY_Pos() - 20);</span>
        }
<span class="fc" id="L1026">        strokeWeight(1);</span>
<span class="fc" id="L1027">    }</span>

    /**
     * Monster management.
     */
    public void monsterManagement(){
<span class="fc" id="L1033">        List&lt;Monster&gt; survivingMonsters = new ArrayList&lt;&gt;(); // to update monsters if they die</span>

<span class="pc bpc" id="L1035" title="1 of 4 branches missed.">        if(lastWave &amp;&amp; !activeMonsters.isEmpty()){</span>
<span class="fc" id="L1036">            lastWaveSpawned = true; // to determine if last wave and monsters are in last wave</span>
        }
<span class="fc bfc" id="L1038" title="All 2 branches covered.">        for (Monster monster : activeMonsters) {</span>
<span class="fc bfc" id="L1039" title="All 2 branches covered.">            if(gamePhase != GamePhase.Paused) {</span>
<span class="fc" id="L1040">                monster.updatePosition(); // move monster to next position</span>
<span class="fc" id="L1041">                monster.MonsterFrameCount++;</span>

<span class="fc bfc" id="L1043" title="All 2 branches covered.">                if(gamePhase == GamePhase.DoubleSpeed){</span>
<span class="fc" id="L1044">                    monster.updatePosition(); // moves double if fast forward</span>
<span class="fc" id="L1045">                    monster.MonsterFrameCount++;</span>
                }
            }
<span class="fc" id="L1048">            image(monster.getType(), monster.getX_Pos(), monster.getY_Pos());  // draw monster</span>

<span class="fc bfc" id="L1050" title="All 2 branches covered.">            if (!monster.getPath().isEmpty()) {</span>
<span class="pc bpc" id="L1051" title="1 of 2 branches missed.">                if(monster.isDead()){</span>
<span class="nc" id="L1052">                    boolean fullDead = false; // if dead plays dying animation 4 frames per image</span>
<span class="nc bnc" id="L1053" title="All 2 branches missed.">                    if(monster.MonsterFrameCount%4 == 0) {</span>
<span class="nc" id="L1054">                        fullDead = monster.dyingAnimation();</span>
                    }
<span class="nc bnc" id="L1056" title="All 2 branches missed.">                    if(fullDead){</span>
<span class="nc" id="L1057">                        gameMana.increaseManaOnKill(monster.getMana_gained_on_kill()); // gain mana when fully killed monster</span>
                    }
                    else{
<span class="nc" id="L1060">                        survivingMonsters.add(monster); // add to surviving monster if not fully dead yet to keep drawing</span>
                    }
<span class="nc" id="L1062">                }</span>
                else {
<span class="fc" id="L1064">                    drawDetails(monster); // draw health bars and slowed if not dying or dead</span>
<span class="fc" id="L1065">                    survivingMonsters.add(monster); // add to existing monsters</span>
                }
            }
            else{
<span class="fc" id="L1069">                boolean gameEnd = gameMana.decreaseMana((int) monster.getHp());  // if reached wizard house, take mana damage</span>
<span class="fc" id="L1070">                monster.resetPath(); // respawns monster</span>
<span class="fc" id="L1071">                monster.slowed = false;</span>
<span class="fc" id="L1072">                survivingMonsters.add(monster);</span>
<span class="pc bpc" id="L1073" title="1 of 2 branches missed.">                if(gameEnd){</span>
<span class="nc" id="L1074">                    gamePhase = GamePhase.Lose;  // if mana &lt;= 0 lose</span>
                }
            }

<span class="fc" id="L1078">        }</span>
<span class="fc" id="L1079">        activeMonsters =  survivingMonsters;  // updates monsters</span>
<span class="fc" id="L1080">    }</span>

    /**
     * Mana management.
     */
    public void manaManagement(){
<span class="fc bfc" id="L1086" title="All 2 branches covered.">        if(customFrameCount % (FPS/multiplier) == 0){</span>
<span class="fc" id="L1087">            gameMana.increaseMana(); // increases mana per second</span>
        }
<span class="fc" id="L1089">    }</span>

    /**
     * Interact gui.
     *
     * @param index the index
     */
    public void interactGUI(int index) {
<span class="fc" id="L1097">        iconSelected.add(icons[index]); // keep icons clicked coloured yellow</span>


<span class="fc bfc" id="L1100" title="All 2 branches covered.">        if (icons[index].equals(&quot;M&quot;)) {</span>
<span class="fc" id="L1101">            gameMana.manaUpgrade(); // upgrade mana if clicked</span>
        }
<span class="fc bfc" id="L1103" title="All 2 branches covered.">        if (icons[index].equals(&quot;P&quot;)) {</span>
<span class="fc bfc" id="L1104" title="All 2 branches covered.">            if (gamePhase == GamePhase.Paused) {</span>
<span class="fc" id="L1105">                gamePhase = GamePhase.Normal;</span>
<span class="fc" id="L1106">                iconSelected.remove(&quot;P&quot;); // unpaused if clicked</span>
            }else {
<span class="pc bpc" id="L1108" title="1 of 2 branches missed.">                if(iconSelected.contains(&quot;FF&quot;)){</span>
<span class="nc" id="L1109">                    iconSelected.remove(&quot;FF&quot;);</span>
                }
<span class="fc" id="L1111">                gamePhase = GamePhase.Paused; // paused if clicked</span>
            }
        }
<span class="fc bfc" id="L1114" title="All 2 branches covered.">        if (icons[index].equals(&quot;T&quot;)) {</span>
<span class="fc bfc" id="L1115" title="All 2 branches covered.">            if (towerOperation == TowerOperation.TowerPlacing) {</span>
<span class="fc" id="L1116">                towerOperation = TowerOperation.Normal; // not placing normal tower anymore</span>
            } else {
<span class="fc" id="L1118">                towerOperation = TowerOperation.TowerPlacing;</span>
<span class="fc" id="L1119">                iconSelected.remove(&quot;S&quot;); // ready to place normal tower if clicked</span>
            }
        }

<span class="fc bfc" id="L1123" title="All 2 branches covered.">        if (icons[index].equals(&quot;S&quot;)) {</span>
<span class="fc bfc" id="L1124" title="All 2 branches covered.">            if(towerOperation == TowerOperation.SlowTowerPlacing){</span>
<span class="fc" id="L1125">                towerOperation = TowerOperation.Normal; // not placing slow tower anymore</span>
<span class="fc" id="L1126">                iconSelected.remove(&quot;S&quot;);</span>
            }
            else{
<span class="fc" id="L1129">                towerOperation = TowerOperation.SlowTowerPlacing;</span>
<span class="fc" id="L1130">                iconSelected.remove(&quot;T&quot;); // ready to place slow tower if clicked</span>
            }
        }

<span class="fc bfc" id="L1134" title="All 2 branches covered.">        if (icons[index].equals(&quot;FF&quot;)) {</span>
<span class="fc bfc" id="L1135" title="All 2 branches covered.">            if (gamePhase == GamePhase.DoubleSpeed) {</span>
<span class="fc" id="L1136">                gamePhase = GamePhase.Normal; // un fastforward if clicked</span>
<span class="fc" id="L1137">                iconSelected.remove(&quot;FF&quot;);</span>
            } else {
<span class="pc bpc" id="L1139" title="1 of 2 branches missed.">                if(iconSelected.contains(&quot;P&quot;)){</span>
<span class="nc" id="L1140">                    iconSelected.remove(&quot;P&quot;);</span>
                }
<span class="fc" id="L1142">                gamePhase = GamePhase.DoubleSpeed; // fastforward if clicked</span>
            }
        }


<span class="fc bfc" id="L1147" title="All 2 branches covered.">        if (towerOperation == TowerOperation.TowerSelected) {</span>
<span class="fc bfc" id="L1148" title="All 2 branches covered.">            if (icons[index].equals(&quot;U1&quot;)) {</span>
<span class="pc bpc" id="L1149" title="1 of 2 branches missed.">                if (gameMana.getMana() - selectedTower.cost_range &gt; 0) {</span>
<span class="fc" id="L1150">                    gameMana.decreaseMana(selectedTower.cost_range); // upgrades selected tower range if clicked</span>
<span class="fc" id="L1151">                    selectedTower.upgradeRange();</span>
                }
            }
<span class="fc bfc" id="L1154" title="All 2 branches covered.">            if (icons[index].equals(&quot;U2&quot;)) {</span>
<span class="pc bpc" id="L1155" title="1 of 2 branches missed.">                if (gameMana.getMana() - selectedTower.cost_speed &gt; 0) {</span>
<span class="fc" id="L1156">                    gameMana.decreaseMana(selectedTower.cost_speed);</span>
<span class="fc" id="L1157">                    selectedTower.upgradeSpeed();  // upgrades selected tower speed if clicked</span>
                }
            }
<span class="fc bfc" id="L1160" title="All 2 branches covered.">            if (icons[index].equals(&quot;U3&quot;)) {</span>
<span class="pc bpc" id="L1161" title="1 of 2 branches missed.">                if (gameMana.getMana() - selectedTower.cost_dmg &gt; 0) {</span>
<span class="fc" id="L1162">                    gameMana.decreaseMana(selectedTower.cost_dmg);</span>
<span class="fc" id="L1163">                    selectedTower.upgradeDamage();  // upgrades selected tower damage if clicked</span>
                }
            }
        }
<span class="pc bpc" id="L1167" title="1 of 4 branches missed.">        if(towerOperation == TowerOperation.TowerPlacing || towerOperation == TowerOperation.TowerDualOperation){</span>
<span class="fc bfc" id="L1168" title="All 2 branches covered.">            if (icons[index].equals(&quot;U1&quot;)) {</span>
<span class="pc bpc" id="L1169" title="2 of 4 branches missed.">                if(gameMana.getMana() - (normal_tower_cost + 10) &gt; 0 &amp;&amp; !upgradeOnSpot.contains(&quot;R&quot;)){</span>
<span class="fc" id="L1170">                    towerOperation = TowerOperation.TowerDualOperation;</span>
<span class="fc" id="L1171">                    normal_tower_cost += 10;  // upgrades tower range if clicked when the tower placed down</span>
<span class="fc" id="L1172">                    upgradeOnSpot.add(&quot;R&quot;);</span>
                }
            }
<span class="fc bfc" id="L1175" title="All 2 branches covered.">            if (icons[index].equals(&quot;U2&quot;)) {</span>
<span class="pc bpc" id="L1176" title="2 of 4 branches missed.">                if(gameMana.getMana() - (normal_tower_cost + 10) &gt; 0 &amp;&amp; !upgradeOnSpot.contains(&quot;S&quot;)){</span>
<span class="fc" id="L1177">                    towerOperation = TowerOperation.TowerDualOperation;</span>
<span class="fc" id="L1178">                    normal_tower_cost += 10; // upgrades tower speed if clicked when the tower placed down</span>
<span class="fc" id="L1179">                    upgradeOnSpot.add(&quot;S&quot;);</span>

                }
            }
<span class="fc bfc" id="L1183" title="All 2 branches covered.">            if (icons[index].equals(&quot;U3&quot;)) {</span>
<span class="pc bpc" id="L1184" title="2 of 4 branches missed.">                if(gameMana.getMana() - (normal_tower_cost + 10) &gt; 0 &amp;&amp; !upgradeOnSpot.contains(&quot;D&quot;)){</span>
<span class="fc" id="L1185">                    towerOperation = TowerOperation.TowerDualOperation;</span>
<span class="fc" id="L1186">                    normal_tower_cost += 10; // upgrades tower damage if clicked when the tower placed down</span>
<span class="fc" id="L1187">                    upgradeOnSpot.add(&quot;D&quot;);</span>
                }
            }
        }



<span class="fc" id="L1194">    }</span>

    /**
     * Fire ball management.
     */
    public void fireBallManagement() {
<span class="fc" id="L1200">        Iterator&lt;Fireball&gt; iterator = activeFireballs.iterator();</span>

<span class="fc bfc" id="L1202" title="All 2 branches covered.">        while (iterator.hasNext()) {</span>
<span class="fc" id="L1203">            Fireball fireball = iterator.next(); // use iterator object to get next fireball</span>

<span class="pc bpc" id="L1205" title="1 of 2 branches missed.">            if (fireball != null) {</span>
<span class="fc bfc" id="L1206" title="All 2 branches covered.">                if (!fireball.reachedTarget()) {</span>
<span class="pc bpc" id="L1207" title="1 of 2 branches missed.">                    if (gamePhase != GamePhase.Paused) {</span>
<span class="fc" id="L1208">                        fireball.moveFireball(); // if fireball hasnt reached target and not paused</span>
<span class="fc bfc" id="L1209" title="All 2 branches covered.">                        if (fireball.reachedTarget()) {</span>
<span class="fc" id="L1210">                            processFireball(fireball, iterator); // deal deductions to target monster if hit</span>
<span class="fc" id="L1211">                            continue;</span>
                        }
<span class="fc bfc" id="L1213" title="All 2 branches covered.">                        if (gamePhase == GamePhase.DoubleSpeed) {</span>
<span class="fc" id="L1214">                            fireball.moveFireball(); // if double speed, move twice</span>
<span class="pc bpc" id="L1215" title="1 of 2 branches missed.">                            if (fireball.reachedTarget()) {</span>
<span class="fc" id="L1216">                                processFireball(fireball, iterator); // deal deductions to target monster if hit</span>
<span class="fc" id="L1217">                                continue;</span>
                            }
                        }
                    }
<span class="fc" id="L1221">                    image(fireball.getType(), fireball.getX(), fireball.getY()); // draw fireball</span>
                } else {
<span class="fc" id="L1223">                    processFireball(fireball, iterator); // deal deductions if hit</span>
                }
            }
<span class="fc" id="L1226">        }</span>
<span class="fc" id="L1227">    }</span>

    private void processFireball(Fireball fireball, Iterator&lt;Fireball&gt; iterator) {
<span class="fc bfc" id="L1230" title="All 2 branches covered.">        if(fireball.getParentTower() instanceof SlowTower){</span>
<span class="fc" id="L1231">            fireball.getTarget().slowMonster(((SlowTower) fireball.getParentTower()).getSlowRate()); // if parent tower slow tower, slow target</span>
        }
<span class="fc" id="L1233">        fireball.getTarget().takeDamage(fireball.getDmg()); // damage tower</span>
<span class="fc" id="L1234">        iterator.remove(); // remove from active fireballs as it already hit object</span>
<span class="fc" id="L1235">    }</span>


    /**
     * Animate screen.
     */
    public void animateScreen(){
<span class="fc" id="L1242">        waveManagement(); // draws wave timer and manges waves</span>
<span class="fc" id="L1243">        monsterManagement(); // draws monsters and manages monsters</span>
<span class="fc" id="L1244">        fireBallManagement();  // draws fireballs and manages fireballs</span>
<span class="fc" id="L1245">        manaManagement(); // manages mana</span>
<span class="fc bfc" id="L1246" title="All 2 branches covered.">        if(gamePhase != GamePhase.Paused) {</span>
<span class="fc" id="L1247">            customFrameCount++; // keeps frame going if not paused</span>
        }
<span class="fc" id="L1249">    }</span>

    /**
     * Icon interaction.
     *
     * @param mouseX the mouse x
     * @param mouseY the mouse y
     */
    public void iconInteraction(int mouseX, int mouseY){
<span class="fc" id="L1258">        int x = WIDTH - SIDEBAR + 10; // 650</span>
<span class="fc" id="L1259">        int y_offset = TOPBAR + 10; //50</span>

<span class="fc" id="L1261">        int i = 0;</span>

<span class="fc bfc" id="L1263" title="All 2 branches covered.">        while(i &lt; icons.length){</span>
<span class="fc" id="L1264">            int boxY = y_offset + (50) * i; //50, 100, 150, 200, 250, 300, 350</span>

<span class="pc bpc" id="L1266" title="2 of 8 branches missed.">            if ((mouseX &gt; x &amp;&amp; mouseX &lt; x + 40) &amp;&amp; (mouseY &gt; boxY &amp;&amp; mouseY &lt; boxY + 40)) {</span>

<span class="fc" id="L1268">                interactGUI(i); // if mouse clicked inside these bounds, interact with buttons and find out what button does</span>
            }
<span class="fc" id="L1270">            i++;</span>
<span class="fc" id="L1271">        }</span>
<span class="fc" id="L1272">    }</span>

    /**
     * Draw towers.
     */
    public void drawTowers(){
<span class="fc bfc" id="L1278" title="All 2 branches covered.">        for (Tower tower : activeTowers) {</span>
<span class="fc" id="L1279">            tower.towerImage(); // get tower image updated if required</span>

<span class="fc bfc" id="L1281" title="All 2 branches covered.">            if(tower.towerFrameCount % Math.floor((FPS/multiplier)/tower.getTower_firing_speed()) == 0) {</span>
<span class="pc bpc" id="L1282" title="1 of 2 branches missed.">                if(gamePhase != GamePhase.Paused) {</span>
<span class="fc" id="L1283">                    Fireball newFireball = tower.shootFireball(activeMonsters); // if tower duration reached, fire a new fireball and add to active fireballs</span>
<span class="pc bpc" id="L1284" title="3 of 4 branches missed.">                    if (newFireball != null &amp;&amp; !activeFireballs.contains(newFireball)) {</span>
<span class="nc" id="L1285">                        activeFireballs.add(newFireball);</span>
                    }
                }
            }

<span class="fc" id="L1290">            image(tower.getType(), tower.getCoordinate().x, tower.getCoordinate().y);</span>
<span class="fc" id="L1291">            drawUpgrades(tower); // draw all user upgrades on towers</span>
<span class="fc" id="L1292">            tower.towerFrameCount++; // upgrades tower frame count</span>
<span class="fc" id="L1293">        }</span>
<span class="fc" id="L1294">    }</span>

    /**
     * Tower placement.
     *
     * @param mouseX the mouse x
     * @param mouseY the mouse y
     */
    public void towerPlacement(int mouseX, int mouseY){
<span class="fc" id="L1303">        int end_x = WIDTH - SIDEBAR;</span>

<span class="pc bpc" id="L1305" title="4 of 8 branches missed.">        if(0 &lt; mouseX &amp;&amp; mouseX &lt; end_x &amp;&amp; TOPBAR &lt; mouseY &amp;&amp; mouseY &lt; HEIGHT) {</span>
<span class="fc" id="L1306">            int x = mouseX/CELLSIZE; // get mouse grid coordinate for grid</span>
<span class="fc" id="L1307">            int y = (mouseY -TOPBAR)/CELLSIZE;</span>

<span class="pc bpc" id="L1309" title="2 of 4 branches missed.">            if(gridBoolean[y][x] &amp;&amp; (gameMana.getMana() - normal_tower_cost &gt; 0)){ // if grid unoccupied</span>
                Tower tower;
<span class="fc" id="L1311">                int CoordX = x * CELLSIZE;</span>
<span class="fc" id="L1312">                int CoordY = y * CELLSIZE + TOPBAR;  // place new tower based on which cell user clicked</span>
<span class="fc" id="L1313">                Coordinate coordinate = new Coordinate(CoordX, CoordY);</span>
<span class="pc bpc" id="L1314" title="1 of 2 branches missed.">                if(towerOperation == TowerOperation.SlowTowerPlacing){  // places slow tower if placing slow tower</span>
<span class="nc" id="L1315">                    tower = new SlowTower(slowTowerImages, coordinate, slowtower_range, slowtower_firing_speed, slowtower_damage, slowballImage, slowtower_slow);</span>
                }
                else{ // places normal tower if placing slow tower
<span class="fc" id="L1318">                    tower = new Tower(normalTowerImages, coordinate, normal_tower_range, normal_firing_speed, normal_tower_damage, fireballImage);</span>
                }

                // upgrades on spot if done before placing down
<span class="pc bpc" id="L1322" title="1 of 2 branches missed.">                if(upgradeOnSpot.contains(&quot;D&quot;)){</span>
<span class="nc" id="L1323">                    tower.upgradeDamage();</span>
                }
<span class="pc bpc" id="L1325" title="1 of 2 branches missed.">                if(upgradeOnSpot.contains(&quot;R&quot;)){</span>
<span class="nc" id="L1326">                    tower.upgradeRange();</span>
                }
<span class="pc bpc" id="L1328" title="1 of 2 branches missed.">                if(upgradeOnSpot.contains(&quot;S&quot;)){</span>
<span class="nc" id="L1329">                    tower.upgradeSpeed();</span>
                }

                //clear upgrades for next tower
                // add to active towers for drawing
                // update mana
                // occupy grid now tower placed
<span class="fc" id="L1336">                upgradeOnSpot.clear();</span>
<span class="fc" id="L1337">                activeTowers.add(tower);</span>
<span class="fc" id="L1338">                gridBoolean[y][x] = false;</span>
<span class="fc" id="L1339">                gameMana.decreaseMana(normal_tower_cost);</span>
<span class="fc" id="L1340">                normal_tower_cost = 100; // reset tower cost from upgrades</span>
            }
        }
<span class="fc" id="L1343">        iconSelected.remove(&quot;T&quot;);</span>

<span class="fc" id="L1345">    }</span>

    /**
     * Load tower variables.
     */
    public void loadTowerVariables(){
<span class="fc" id="L1351">        normal_tower_cost = config.getInt(&quot;tower_cost&quot;);</span>
<span class="fc" id="L1352">        normal_tower_range = config.getInt(&quot;initial_tower_range&quot;); // load variables from config</span>
<span class="fc" id="L1353">        normal_firing_speed = config.getDouble(&quot;initial_tower_firing_speed&quot;);</span>
<span class="fc" id="L1354">        normal_tower_damage = config.getInt(&quot;initial_tower_damage&quot;);</span>

<span class="fc" id="L1356">        slowtower_cost = config.getInt(&quot;slowtower_cost&quot;);</span>
<span class="fc" id="L1357">        slowtower_range = config.getInt(&quot;initial_slowtower_range&quot;);</span>
<span class="fc" id="L1358">        slowtower_firing_speed = config.getDouble(&quot;initial_slowtower_firing_speed&quot;);</span>
<span class="fc" id="L1359">        slowtower_damage = config.getInt(&quot;initial_slowtower_damage&quot;);</span>
<span class="fc" id="L1360">        slowtower_slow = config.getDouble(&quot;slowtower_slow&quot;);</span>
<span class="fc" id="L1361">    }</span>

    /**
     * Load mana.
     */
    public void loadMana(){
<span class="fc" id="L1367">        int initial_mana = config.getInt(&quot;initial_mana&quot;);</span>
<span class="fc" id="L1368">        int initial_cap = config.getInt(&quot;initial_mana_cap&quot;); // load mana variables from config and makes mana object</span>
<span class="fc" id="L1369">        double initial_rate = config.getDouble(&quot;initial_mana_gained_per_second&quot;);</span>
<span class="fc" id="L1370">        int initial_cost = config.getInt(&quot;mana_pool_spell_initial_cost&quot;);</span>
<span class="fc" id="L1371">        int costincrease = config.getInt(&quot;mana_pool_spell_cost_increase_per_use&quot;);</span>
<span class="fc" id="L1372">        double capincrease = config.getDouble(&quot;mana_pool_spell_cap_multiplier&quot;);</span>
<span class="fc" id="L1373">        double rateincrease = config.getDouble(&quot;mana_pool_spell_mana_gained_multiplier&quot;);</span>
<span class="fc" id="L1374">        gameMana = new Mana(initial_cost, initial_rate, initial_mana, initial_cap, costincrease,capincrease,rateincrease);</span>
<span class="fc" id="L1375">    }</span>

    /**
     * Draw selected tower.
     *
     * @param tower the tower
     */
    public void drawSelectedTower(Tower tower){
<span class="fc" id="L1383">        int centerX = (int) tower.getCoordinate().x + 16;</span>
<span class="fc" id="L1384">        int centerY = (int) tower.getCoordinate().y + 16;</span>

<span class="fc" id="L1386">        stroke(255, 255, 0); // draws circular range of selected tower</span>
<span class="fc" id="L1387">        noFill();</span>

<span class="fc" id="L1389">        ellipse(centerX, centerY, tower.getTower_range() * 2, tower.getTower_range() * 2);</span>



        // displays upgrade menu costs of selected tower
<span class="fc" id="L1394">        stroke(0);</span>
<span class="fc" id="L1395">        fill(255, 255, 255);</span>

<span class="fc" id="L1397">        rect(650, 550, 100, 30);</span>

<span class="fc" id="L1399">        fill(0);</span>
<span class="fc" id="L1400">        textSize(12);</span>
<span class="fc" id="L1401">        text(&quot;Upgrade Cost&quot;, 700, 565);</span>

<span class="fc" id="L1403">        stroke(0);</span>
<span class="fc" id="L1404">        fill(255, 255, 255);</span>

<span class="fc" id="L1406">        rect(650, 580, 100, 50);</span>

<span class="fc" id="L1408">        fill(0);</span>
<span class="fc" id="L1409">        textSize(12);</span>
<span class="fc bfc" id="L1410" title="All 4 branches covered.">        if(tower.damage_level == tower.range_level &amp;&amp; tower.range_level == tower.speed_level){</span>
<span class="fc" id="L1411">            text(&quot;Damage: &quot; + tower.cost_dmg, 700, 590);</span>
<span class="fc" id="L1412">            text(&quot;Speed: &quot; + tower.cost_speed, 700, 605);</span>
<span class="fc" id="L1413">            text(&quot;Range: &quot; + tower.cost_range, 700, 620);</span>
<span class="fc" id="L1414">            tower_cost_combination += tower.cost_dmg + tower.cost_speed + tower.cost_range;</span>
        }
        else {
<span class="fc bfc" id="L1417" title="All 4 branches covered.">            if (tower.damage_level &lt; tower.range_level || tower.damage_level &lt; tower.speed_level) {</span>
<span class="fc" id="L1418">                text(&quot;Damage: &quot; + tower.cost_dmg, 700, 590);</span>
<span class="fc" id="L1419">                tower_cost_combination += tower.cost_dmg;</span>
            }
<span class="fc bfc" id="L1421" title="All 4 branches covered.">            if (tower.speed_level &lt; tower.range_level || tower.speed_level &lt; tower.damage_level) {</span>
<span class="fc" id="L1422">                text(&quot;Speed: &quot; + tower.cost_speed, 700, 605);</span>
<span class="fc" id="L1423">                tower_cost_combination += tower.cost_speed;</span>
            }
<span class="fc bfc" id="L1425" title="All 4 branches covered.">            if (tower.range_level &lt; tower.speed_level || tower.range_level &lt; tower.damage_level) {</span>
<span class="fc" id="L1426">                text(&quot;Range: &quot; + tower.cost_range, 700, 620);</span>
<span class="fc" id="L1427">                tower_cost_combination += tower.cost_range;</span>
            }
        }

<span class="fc" id="L1431">        stroke(0);</span>
<span class="fc" id="L1432">        fill(255, 255, 255);</span>

<span class="fc" id="L1434">        rect(650, 630, 100, 30);</span>

<span class="fc" id="L1436">        fill(0);</span>
<span class="fc" id="L1437">        textSize(12);</span>
<span class="fc" id="L1438">        text(&quot;Total: &quot; + tower_cost_combination, 700, 645);</span>

<span class="fc" id="L1440">        stroke(0);</span>
<span class="fc" id="L1441">        strokeWeight(1);</span>
<span class="fc" id="L1442">        tower_cost_combination = 0;</span>
<span class="fc" id="L1443">    }</span>

    /**
     * Draw upgrades.
     *
     * @param tower the tower
     */
    public void drawUpgrades(Tower tower){
<span class="pc bpc" id="L1451" title="5 of 10 branches missed.">        if (!(tower.speed_level == tower.range_level &amp;&amp; tower.range_level == tower.damage_level) || (tower.speed_level &gt; 2 &amp;&amp; tower.range_level &gt; 2 &amp;&amp; tower.damage_level &gt; 2)){</span>
<span class="fc" id="L1452">            fill(255, 0, 255);</span>
<span class="fc" id="L1453">            textSize(9);</span>
<span class="fc bfc" id="L1454" title="All 2 branches covered.">            for (int i = 0; i &lt; tower.range_level; i++) {</span>
<span class="fc" id="L1455">                text(&quot;O&quot;, tower.getCoordinate().x + i * 5, tower.getCoordinate().y + 5); // draw O's for each level of range</span>
            }
<span class="fc" id="L1457">            stroke(0);</span>
<span class="fc" id="L1458">            strokeWeight(1);</span>
<span class="fc" id="L1459">            noFill();</span>
<span class="fc" id="L1460">            stroke(0, 100, 200);</span>
<span class="fc bfc" id="L1461" title="All 2 branches covered.">            for (int i = 0; i &lt; tower.speed_level; i++) {</span>
<span class="fc" id="L1462">                strokeWeight(1 + i);</span>
<span class="fc" id="L1463">                float squareX = tower.getCoordinate().x + CELLSIZE / 4;</span>
<span class="fc" id="L1464">                float squareY = tower.getCoordinate().y + CELLSIZE / 4;</span>
<span class="fc" id="L1465">                rect(squareX, squareY, CELLSIZE / 2, CELLSIZE / 2); // draw square for each speed level and thickens</span>
            }
<span class="fc" id="L1467">            stroke(0);</span>
<span class="fc" id="L1468">            strokeWeight(1);</span>
<span class="fc bfc" id="L1469" title="All 2 branches covered.">            for (int i = 0; i &lt; tower.damage_level; i++) {</span>
<span class="fc" id="L1470">                text(&quot;X&quot;, tower.getCoordinate().x + i * 5, tower.getCoordinate().y + App.CELLSIZE); // draw X's for each level of damage</span>
            }
<span class="fc" id="L1472">            stroke(0);</span>
<span class="fc" id="L1473">            strokeWeight(1);</span>
        }
<span class="fc" id="L1475">    }</span>

    /**
     * Load balls.
     */
    public void loadBalls(){
<span class="fc" id="L1481">        fireballImage = loadImage(&quot;src/main/resources/WizardTD/fireball.png&quot;);</span>
<span class="fc" id="L1482">        slowballImage = loadImage(&quot;src/main/resources/WizardTD/slowball.png&quot;); // load fireball images</span>
<span class="fc" id="L1483">    }</span>

    /**
     * Load monster images list.
     *
     * @param s the s
     * @return the list
     */
    public List&lt;PImage&gt; loadMonsterImages(String s){
<span class="fc" id="L1492">        List&lt;PImage&gt; gremlinImgs = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L1493">        List&lt;PImage&gt; beetleImgs = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L1494">        List&lt;PImage&gt; wormImgs = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L1495">        gremlinImgs.add(loadImage(&quot;src/main/resources/WizardTD/gremlin.png&quot;));</span>
<span class="fc" id="L1496">        gremlinImgs.add(loadImage(&quot;src/main/resources/WizardTD/gremlin1.png&quot;));</span>
<span class="fc" id="L1497">        gremlinImgs.add(loadImage(&quot;src/main/resources/WizardTD/gremlin2.png&quot;));</span>
<span class="fc" id="L1498">        gremlinImgs.add(loadImage(&quot;src/main/resources/WizardTD/gremlin3.png&quot;)); // load images of monsters</span>
<span class="fc" id="L1499">        gremlinImgs.add(loadImage(&quot;src/main/resources/WizardTD/gremlin4.png&quot;));</span>
<span class="fc" id="L1500">        gremlinImgs.add(loadImage(&quot;src/main/resources/WizardTD/gremlin5.png&quot;));</span>
<span class="fc" id="L1501">        beetleImgs.add(loadImage(&quot;src/main/resources/WizardTD/beetle.png&quot;));</span>
<span class="fc" id="L1502">        wormImgs.add(loadImage(&quot;src/main/resources/WizardTD/worm.png&quot;));</span>

<span class="pc bpc" id="L1504" title="1 of 2 branches missed.">        if(s.equals(&quot;gremlin&quot;)){</span>
<span class="fc" id="L1505">            return gremlinImgs;</span>
        }
<span class="nc bnc" id="L1507" title="All 2 branches missed.">        else if(s.equals(&quot;worm&quot;)){</span>
<span class="nc" id="L1508">            return wormImgs; // return each PImage list based on whatever config asks for</span>
        }
<span class="nc bnc" id="L1510" title="All 2 branches missed.">        else if(s.equals(&quot;beetle&quot;)){</span>
<span class="nc" id="L1511">            return beetleImgs;</span>
        }
        else{
<span class="nc" id="L1514">            return null;</span>
        }

    }

    /**
     * Instantiates a new App.
     */
<span class="fc" id="L1522">    public App() {</span>
<span class="fc" id="L1523">        this.configPath = &quot;config.json&quot;;</span>
<span class="fc" id="L1524">    }</span>

    /**
     * Initialise the setting of the window size.
     */
	@Override
    public void settings() {
<span class="fc" id="L1531">        size(WIDTH, HEIGHT);</span>
<span class="fc" id="L1532">    }</span>

    /**
     * Load all resources such as images. Initialise the elements such as the player, enemies and map elements.
     */
	@Override
    public void setup() {
<span class="fc" id="L1539">        frameRate(FPS);</span>
<span class="fc" id="L1540">        size(760, 680);</span>

<span class="fc" id="L1542">        config = loadJSON(this.configPath);</span>
<span class="fc" id="L1543">        entrances = getEntrances();</span>
<span class="fc" id="L1544">        setupGrid();</span>
<span class="fc" id="L1545">        loadTowerImage();</span>
<span class="fc" id="L1546">        loadMapImages();</span>
<span class="fc" id="L1547">        loadTowerVariables();</span>
<span class="fc" id="L1548">        loadMana();</span>
<span class="fc" id="L1549">        loadBalls();</span>
<span class="fc" id="L1550">        loadWaves(); // load all variables for game</span>

<span class="fc" id="L1552">    }</span>


    /**
     * Receive key pressed signal from the keyboard.
     */
	@Override
    public void keyPressed(){
<span class="pc bpc" id="L1560" title="3 of 6 branches missed.">        if (key == 'r' || key == 'R' &amp;&amp; gamePhase == GamePhase.Lose) {</span>
<span class="fc" id="L1561">            restartGamePhase(); // if loses and user pressed 'R', restarts game</span>
        }

<span class="pc bpc" id="L1564" title="1 of 4 branches missed.">        if (key == 'M' || key == 'm') {</span>
<span class="fc" id="L1565">            gameMana.manaUpgrade();</span>
<span class="fc" id="L1566">            iconSelected.add(&quot;M&quot;); // upgrade mana if 'M' pressed</span>
        }

<span class="pc bpc" id="L1569" title="1 of 4 branches missed.">        if (key == 'P' || key == 'p') {</span>
<span class="fc bfc" id="L1570" title="All 2 branches covered.">            if(gamePhase == GamePhase.Paused){</span>
<span class="fc" id="L1571">                gamePhase = GamePhase.Normal; // unpauses if 'P' pressed</span>
<span class="fc" id="L1572">                iconSelected.remove(&quot;P&quot;);</span>
            }
<span class="pc bpc" id="L1574" title="1 of 2 branches missed.">            else if(gamePhase != GamePhase.Lose){</span>
<span class="fc" id="L1575">                gamePhase = GamePhase.Paused;</span>
<span class="fc" id="L1576">                iconSelected.add(&quot;P&quot;); // pauses if 'P' pressed</span>
<span class="fc" id="L1577">                iconSelected.remove(&quot;FF&quot;);</span>
            }
        }

<span class="pc bpc" id="L1581" title="1 of 4 branches missed.">        if (key == 'F' || key == 'f') {</span>
<span class="fc bfc" id="L1582" title="All 2 branches covered.">            if(gamePhase == GamePhase.DoubleSpeed){</span>
<span class="fc" id="L1583">                gamePhase = GamePhase.Normal; // un fastforwards if 'F' pressed</span>
<span class="fc" id="L1584">                iconSelected.remove(&quot;FF&quot;);</span>
            }
<span class="pc bpc" id="L1586" title="1 of 2 branches missed.">            else if(gamePhase != GamePhase.Lose){</span>
<span class="fc" id="L1587">                gamePhase = GamePhase.DoubleSpeed;</span>
<span class="fc" id="L1588">                iconSelected.add(&quot;FF&quot;); // fastforwards if 'F' pressed</span>
<span class="fc" id="L1589">                iconSelected.remove(&quot;P&quot;);</span>
            }
        }

<span class="pc bpc" id="L1593" title="1 of 4 branches missed.">        if (key == 'T' || key == 't') {</span>
<span class="fc bfc" id="L1594" title="All 2 branches covered.">            if(towerOperation == TowerOperation.TowerPlacing){</span>
<span class="fc" id="L1595">                towerOperation = TowerOperation.Normal; // if already placing tower, stop this operation when 'T' pressed</span>
<span class="fc" id="L1596">                iconSelected.remove(&quot;T&quot;);</span>
            }
            else{
<span class="fc" id="L1599">                towerOperation = TowerOperation.TowerPlacing;</span>
<span class="fc" id="L1600">                iconSelected.add(&quot;T&quot;); //  set operation to placing tower when 'T' pressed</span>
<span class="fc" id="L1601">                iconSelected.remove(&quot;S&quot;);</span>

            }
        }
<span class="pc bpc" id="L1605" title="1 of 4 branches missed.">        if (key == 'S' || key == 's') {</span>
<span class="fc bfc" id="L1606" title="All 2 branches covered.">            if(towerOperation == TowerOperation.SlowTowerPlacing){</span>
<span class="fc" id="L1607">                towerOperation = TowerOperation.Normal; // if already placing slow tower, stop this operation when 'S' pressed</span>
<span class="fc" id="L1608">                iconSelected.remove(&quot;S&quot;);</span>
            }
            else{
<span class="fc" id="L1611">                towerOperation = TowerOperation.SlowTowerPlacing;</span>
<span class="fc" id="L1612">                iconSelected.add(&quot;S&quot;); // set operation placing slow tower when 'S' pressed</span>
<span class="fc" id="L1613">                iconSelected.remove(&quot;T&quot;);</span>
            }
        }
<span class="fc bfc" id="L1616" title="All 2 branches covered.">        if(towerOperation == TowerOperation.TowerSelected){</span>
<span class="fc bfc" id="L1617" title="All 2 branches covered.">            if (key == '1') {</span>
<span class="pc bpc" id="L1618" title="1 of 2 branches missed.">                if(gameMana.getMana() - selectedTower.cost_range &gt; 0){</span>
<span class="fc" id="L1619">                    gameMana.decreaseMana(selectedTower.cost_range); // upgrade range of selected tower if '1' Pressed</span>
<span class="fc" id="L1620">                    selectedTower.upgradeRange();</span>
                }
<span class="fc" id="L1622">                iconSelected.add(&quot;U1&quot;);</span>
            }
<span class="fc bfc" id="L1624" title="All 2 branches covered.">            if (key == '2') {</span>
<span class="pc bpc" id="L1625" title="1 of 2 branches missed.">                if(gameMana.getMana() - selectedTower.cost_speed &gt; 0){</span>
<span class="fc" id="L1626">                    gameMana.decreaseMana(selectedTower.cost_speed); // upgrade speed of selected tower if '2' Pressed</span>
<span class="fc" id="L1627">                    selectedTower.upgradeSpeed();</span>
                }
<span class="fc" id="L1629">                iconSelected.add(&quot;U2&quot;);</span>
            }
<span class="fc bfc" id="L1631" title="All 2 branches covered.">            if (key == '3') {</span>
<span class="pc bpc" id="L1632" title="1 of 2 branches missed.">                if(gameMana.getMana() - selectedTower.cost_dmg &gt; 0){</span>
<span class="fc" id="L1633">                    gameMana.decreaseMana(selectedTower.cost_dmg); // upgrade damage of selected tower if '3' Pressed</span>
<span class="fc" id="L1634">                    selectedTower.upgradeDamage();</span>
                }
<span class="fc" id="L1636">                iconSelected.add(&quot;U3&quot;);</span>
            }
        }
<span class="pc bpc" id="L1639" title="1 of 4 branches missed.">        if(towerOperation == TowerOperation.TowerPlacing || towerOperation == TowerOperation.TowerDualOperation){</span>
<span class="fc bfc" id="L1640" title="All 2 branches covered.">            if (key == '1') {</span>
<span class="pc bpc" id="L1641" title="2 of 4 branches missed.">                if(gameMana.getMana() - (normal_tower_cost + 10) &gt; 0 &amp;&amp; !upgradeOnSpot.contains(&quot;R&quot;)){</span>
<span class="fc" id="L1642">                    towerOperation = TowerOperation.TowerDualOperation;</span>
<span class="fc" id="L1643">                    normal_tower_cost += 10; // upgrade range of upcoming tower if '1' Pressed</span>
<span class="fc" id="L1644">                    upgradeOnSpot.add(&quot;R&quot;);</span>
                }
<span class="fc" id="L1646">                iconSelected.add(&quot;U1&quot;);</span>
            }
<span class="fc bfc" id="L1648" title="All 2 branches covered.">            if (key == '2') {</span>
<span class="pc bpc" id="L1649" title="2 of 4 branches missed.">                if(gameMana.getMana() - (normal_tower_cost + 10) &gt; 0 &amp;&amp; !upgradeOnSpot.contains(&quot;S&quot;)){</span>
<span class="fc" id="L1650">                    towerOperation = TowerOperation.TowerDualOperation;</span>
<span class="fc" id="L1651">                    normal_tower_cost += 10; // upgrade speed of upcoming tower if '2' Pressed</span>
<span class="fc" id="L1652">                    upgradeOnSpot.add(&quot;S&quot;);</span>

                }
<span class="fc" id="L1655">                iconSelected.add(&quot;U2&quot;);</span>
            }
<span class="fc bfc" id="L1657" title="All 2 branches covered.">            if (key == '3') {</span>
<span class="pc bpc" id="L1658" title="2 of 4 branches missed.">                if(gameMana.getMana() - (normal_tower_cost + 10) &gt; 0 &amp;&amp; !upgradeOnSpot.contains(&quot;D&quot;)){</span>
<span class="fc" id="L1659">                    towerOperation = TowerOperation.TowerDualOperation;</span>
<span class="fc" id="L1660">                    normal_tower_cost += 10; // upgrade damage of upcoming tower if '3' Pressed</span>
<span class="fc" id="L1661">                    upgradeOnSpot.add(&quot;D&quot;);</span>
                }
<span class="fc" id="L1663">                iconSelected.add(&quot;U3&quot;);</span>
            }
        }
<span class="fc" id="L1666">    }</span>

    /**
     * Receive key released signal from the keyboard.
     */
	@Override
    public void keyReleased(){

<span class="nc" id="L1674">    }</span>

    @Override
    public void mousePressed(MouseEvent e) {
<span class="fc" id="L1678">        int mouseX = e.getX();</span>
<span class="fc" id="L1679">        int mouseY = e.getY(); // get x and y coordinates of mouse click</span>
<span class="pc bpc" id="L1680" title="5 of 6 branches missed.">        if(towerOperation == TowerOperation.TowerPlacing || towerOperation == TowerOperation.TowerDualOperation || towerOperation == TowerOperation.SlowTowerPlacing) {</span>
<span class="fc" id="L1681">            towerPlacement(mouseX, mouseY); // handles tower placement depending where mouse pressed</span>
        }
<span class="fc" id="L1683">        checkTowerSelected(mouseX, mouseY); // check if user clicked a tower</span>

<span class="fc" id="L1685">    }</span>

    @Override
    public void mouseReleased(MouseEvent e) {
<span class="fc" id="L1689">        int mouseX = e.getX();</span>
<span class="fc" id="L1690">        int mouseY = e.getY(); // get x and y coordinates of mouse click</span>

<span class="fc" id="L1692">        iconInteraction(mouseX, mouseY); // see which icon mouse clicked</span>

<span class="fc" id="L1694">    }</span>

    /*@Override
    public void mouseDragged(MouseEvent e) {

    }*/

    /**
     * Draw all elements in the game by current frame.
     */
	@Override
    public void draw() {


<span class="fc bfc" id="L1708" title="All 2 branches covered.">        if(gamePhase == GamePhase.Lose){</span>
<span class="fc" id="L1709">            iconSelected.clear(); // if game lose, stop game completely</span>
<span class="fc" id="L1710">            textGameEnd(); // display text</span>
<span class="fc" id="L1711">            return;</span>
        }

<span class="pc bpc" id="L1714" title="1 of 2 branches missed.">        if(gamePhase == GamePhase.Win){</span>
<span class="nc" id="L1715">            iconSelected.clear(); // if game win, stop game completely</span>
<span class="nc" id="L1716">            textGameWin(); // display text</span>
<span class="nc" id="L1717">            return;</span>
        }

<span class="fc bfc" id="L1720" title="All 2 branches covered.">        if(gamePhase == GamePhase.DoubleSpeed){</span>
<span class="fc" id="L1721">            multiplier = 2.0; // changes multiplier to double when fast forwarded</span>
        }
        else{
<span class="fc" id="L1724">            multiplier = 1.0;</span>
        }

<span class="fc bfc" id="L1727" title="All 4 branches covered.">        if(gamePhase == GamePhase.Normal &amp;&amp; towerOperation == TowerOperation.Normal){</span>
<span class="fc" id="L1728">            iconSelected.clear(); // clear all icons selected if nothing happening</span>
        }

<span class="fc" id="L1731">        background(132, 115, 74); // colour background</span>
<span class="fc" id="L1732">        Map(); //draw map</span>
<span class="fc bfc" id="L1733" title="All 2 branches covered.">        if(selectedTower != null){</span>
<span class="fc" id="L1734">            drawSelectedTower(selectedTower); // if selected a tower, draw its range feature and upgrade cost menu</span>
<span class="pc bpc" id="L1735" title="3 of 10 branches missed.">            if((selectedTower.damage_level == selectedTower.range_level &amp;&amp; selectedTower.range_level == selectedTower.speed_level) || (iconSelected.contains(&quot;U3&quot;) &amp;&amp; iconSelected.contains(&quot;U2&quot;) &amp;&amp; iconSelected.contains(&quot;U1&quot;))){</span>
<span class="fc" id="L1736">                iconSelected.remove(&quot;U3&quot;);</span>
<span class="fc" id="L1737">                iconSelected.remove(&quot;U2&quot;);</span>
<span class="fc" id="L1738">                iconSelected.remove(&quot;U1&quot;);</span>
            }
        }

<span class="fc" id="L1742">        drawTowers(); // draw other towers</span>
<span class="fc" id="L1743">        drawButtons(); // draw buttons</span>



<span class="fc" id="L1747">        animateScreen(); // draw all animated parts of map like monsters, fireballs</span>

<span class="fc" id="L1749">        WizardHouse(); // draws wizard house</span>
<span class="fc" id="L1750">        drawMana(); // draw mana bar</span>

<span class="fc bfc" id="L1752" title="All 2 branches covered.">        if(gamePhase != GamePhase.Paused) {</span>
<span class="fc" id="L1753">            waveTimer -= (1.0 / FPS)*multiplier; // updates wave timer if not paused</span>
        }

<span class="pc bpc" id="L1756" title="3 of 4 branches missed.">        if(activeMonsters.isEmpty() &amp;&amp; lastWaveSpawned){ // if last wave and killed all monsters in that wave</span>
<span class="nc" id="L1757">            iconSelected.clear(); // remove all icons selected</span>
<span class="nc" id="L1758">            gamePhase = GamePhase.Win; // win game</span>
        }


<span class="fc" id="L1762">    }</span>

    /**
     * The entry point of application.
     *
     * @param args the input arguments
     */
    public static void main(String[] args) {
<span class="nc" id="L1770">        PApplet.main(&quot;WizardTD.App&quot;);</span>
<span class="nc" id="L1771">    }</span>

    /**
     * Source: https://stackoverflow.com/questions/37758061/rotate-a-buffered-image-in-java
     *
     * @param pimg  The image to be rotated
     * @param angle between 0 and 360 degrees
     * @return the new rotated image
     */
    public PImage rotateImageByDegrees(PImage pimg, double angle) {
<span class="fc" id="L1781">        BufferedImage img = (BufferedImage) pimg.getNative();</span>
<span class="fc" id="L1782">        double rads = Math.toRadians(angle);</span>
<span class="fc" id="L1783">        double sin = Math.abs(Math.sin(rads)), cos = Math.abs(Math.cos(rads));</span>
<span class="fc" id="L1784">        int w = img.getWidth();</span>
<span class="fc" id="L1785">        int h = img.getHeight();</span>
<span class="fc" id="L1786">        int newWidth = (int) Math.floor(w * cos + h * sin);</span>
<span class="fc" id="L1787">        int newHeight = (int) Math.floor(h * cos + w * sin);</span>

<span class="fc" id="L1789">        PImage result = this.createImage(newWidth, newHeight, ARGB);</span>
        //BufferedImage rotated = new BufferedImage(newWidth, newHeight, BufferedImage.TYPE_INT_ARGB);
<span class="fc" id="L1791">        BufferedImage rotated = (BufferedImage) result.getNative();</span>
<span class="fc" id="L1792">        Graphics2D g2d = rotated.createGraphics();</span>
<span class="fc" id="L1793">        AffineTransform at = new AffineTransform();</span>
<span class="fc" id="L1794">        at.translate((newWidth - w) / 2, (newHeight - h) / 2);</span>

<span class="fc" id="L1796">        int x = w / 2;</span>
<span class="fc" id="L1797">        int y = h / 2;</span>

<span class="fc" id="L1799">        at.rotate(rads, x, y);</span>
<span class="fc" id="L1800">        g2d.setTransform(at);</span>
<span class="fc" id="L1801">        g2d.drawImage(img, 0, 0, null);</span>
<span class="fc" id="L1802">        g2d.dispose();</span>
<span class="fc bfc" id="L1803" title="All 2 branches covered.">        for (int i = 0; i &lt; newWidth; i++) {</span>
<span class="fc bfc" id="L1804" title="All 2 branches covered.">            for (int j = 0; j &lt; newHeight; j++) {</span>
<span class="fc" id="L1805">                result.set(i, j, rotated.getRGB(i, j));</span>
            }
        }

<span class="fc" id="L1809">        return result;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>